<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="./css/app.css">
	<link rel="manifest" href="/manifest.json">
	<title>Document</title>
</head>
<body>
	<div class="circle">
		<div class="pie-left">
			<div class="left"></div>
		</div>
		<div class="pie-right">
			<div class="right"></div>
		</div>
		<div class="mask"><span id="countdown">00</span></div>
	</div>
	<div class="set">
		<input type="text" id="time">
		<label for="time">minutes</label>
		<div class="btn">sure</div>
	</div>
	<script>
		;(function(){
			if('serviceWorker' in navigator){
				navigator.serviceWorker.register('./sw.js').then(function(reg){
					console.log('register')
				}).catch(function(error){
					console.log(error)
				})
			}

			var leftCircle = document.querySelector('.left'),
				rightCircle = document.querySelector('.right'),
				countdown = document.getElementById('countdown'),
				btn = document.querySelector('.btn'),
				timer = null

			btn.addEventListener('click',function(){
				rightCircle.style.cssText = 'transform:rotate(0)'
				leftCircle.style.cssText = 'transform:rotate(0)'
				var time = +document.getElementById('time').value,
					now = new Date(),
					endTime = now.setMinutes(now.getMinutes() + time)
				function t(){
					var current = new Date(),
						remaine = 1 - (endTime - current) / (time * 60 * 1000),
						angle = Math.round(remaine * 360)
					angle = angle > 360 ? 360 : angle
					countdown.innerHTML = formateTime(endTime - current)
					if(angle <= 180){
						rightCircle.style.cssText = 'transform:rotate('+angle+'deg)'
					}else{
						rightCircle.style.cssText = 'transform:rotate(180deg)'
						leftCircle.style.cssText = 'transform:rotate('+(angle-180)+'deg)'						
					}

					if(angle < 360){
						timer = setTimeout(t,1000)
					}
				}
				t()
			},false)
			function formateTime(ms){
				var sec = ms / 1000,s,m,h,tiemText = ''
				if(sec > 0){
					s = Math.floor(sec % 60),
					m = Math.floor(sec / 60) % 60,
					h = Math.floor(sec / 3600)
					tiemText = h + '时' + m + '分' + s + '秒' 
				}else{
					tiemText = '倒计时结束'
					navigator.vibrate && navigator.vibrate(5000)
				}
				return tiemText
			}
		})()
	</script>
</body>
</html>